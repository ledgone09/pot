// Language translations from React version
const translations = {
    en: {
        // Navigation
        'nav.home': 'Home',
        'nav.characters': 'Characters',
        'nav.about': 'About',
        'nav.parents': 'For Parents',

        // Hero Section
        'hero.title': 'Welcome to the Rainbow Kingdom',
        'hero.welcome': 'WELCOME',
        'hero.to': 'TO',
        'hero.the': 'THE',
        'hero.kingdom': 'KINGDOM',
        'hero.title.mobile.line1': 'WELCOME',
        'hero.title.mobile.line2': 'THE RAINBOW',
        'hero.title.mobile.line3': 'KINGDOM',
        'hero.title.desktop.line1': 'WELCOME TO THE RAINBOW ',
        'hero.title.desktop.line2': 'KINGDOM',
        'hero.subtitle': 'A magical world where everyone is friends and adventure awaits just around the corner!',
        'hero.description': 'Join Rainbow, Lily the Fox, Lavender Fairy, Robin, and Andrew the Mole on exciting adventures that teach friendship, problem-solving, and the importance of equality.',
        'hero.watchTrailer': 'Watch Trailer',
        'hero.meetCharacters': 'Meet Characters',

        // Characters Section
        'characters.title': 'Meet Our Amazing Characters',
        'characters.subtitle': 'Discover the complete stories, personalities, and magical qualities of each beloved character from Rainbow Kingdom!',
        'characters.learnMore': 'Learn More About',
        'characters.keyTraits': 'Key Traits',
        'characters.meetAllFriends': 'Meet All Our Friends',
        'characters.shareTheLove': 'Share the Love',

        // Character Data
        'character.rainbow.name': 'Rainbow',
        'character.rainbow.nickname': 'Rainbow',
        'character.rainbow.description': 'Rainbow is the cheerful and wise prince of Rainbow Kingdom, a place where everyone is equal. With his unmistakable rainbow-colored butt, Rainbow is confident, friendly, and always ready for a new adventure. Although he\'s the smart one, he\'s also a bit goofy, making him the perfect leader and friend in this colorful land.',
        'character.rainbow.quote': 'In Rainbow Kingdom, everyone is equal and special!',

        'character.lily.name': 'Lily the Fox',
        'character.lily.nickname': 'Lily',
        'character.lily.description': 'Lily is the clever and quick-witted fox of the group. Her superhero motto? "No disaster, I think faster, I\'m the master!" She\'s the one who always knows what to do in a tricky situation. Though she can be a bit cheeky, it\'s all in good fun, and she\'s always there to lend a helping paw when her friends need her.',
        'character.lily.quote': 'No disaster, I think faster, I\'m the master!',

        'character.lavender.name': 'Lavender Fairy',
        'character.lavender.nickname': 'Lavender',
        'character.lavender.description': 'Lavender Fairy is the magical helper who makes occasional appearances to sprinkle a little bit of magic into every episode. Her good-hearted nature and miraculous powers make her the go-to fairy for solving problems with a touch of enchantment.',
        'character.lavender.quote': 'A sprinkle of magic makes everything better!',

        'character.robin.name': 'Robin',
        'character.robin.nickname': 'Robin',
        'character.robin.description': 'Robin is a tiny bird with a heart as big as Rainbow Kingdom itself! Bursting with color, Robin may be small, but they stand out in their own special way. Whether flying high or singing sweetly, Robin brings joy and a splash of color wherever they go.',
        'character.robin.quote': 'Small but mighty, with a colorful heart!',

        'character.andrew.name': 'Andrew the Mole',
        'character.andrew.nickname': 'Andrew',
        'character.andrew.description': 'Andrew the Mole is the lovable, clumsy character who always means well, but somehow ends up causing a bit of chaos. His good intentions often lead to hilarious mishaps, but his big heart and never-give-up attitude make him a favorite among the kids. Andrew\'s adventures remind us that it\'s okay to make mistakes, as long as you keep trying!',
        'character.andrew.quote': 'Oops! But I never give up trying!',

        // Popup specific translations
        'popup.traits': 'Character Traits',

        // Character Traits
        'trait.wise': 'Wise',
        'trait.cheerful': 'Cheerful',
        'trait.leader': 'Leader',
        'trait.confident': 'Confident',
        'trait.clever': 'Clever',
        'trait.witty': 'Witty',
        'trait.helpful': 'Helpful',
        'trait.smart': 'Smart',
        'trait.magical': 'Magical',
        'trait.kind': 'Kind',
        'trait.enchanting': 'Enchanting',
        'trait.brave': 'Brave',
        'trait.loyal': 'Loyal',
        'trait.energetic': 'Energetic',
        'trait.musical': 'Musical',
        'trait.persistent': 'Persistent',
        'trait.funny': 'Funny',
        'trait.determined': 'Determined',
        'trait.lovable': 'Lovable',

        // About Section
        'about.title': 'Educational Entertainment That Matters',
        'about.subtitle': 'Rainbow Kingdom promotes equality, friendship, and problem-solving through engaging adventures that children love and parents trust.',
        'about.pageTitle': 'About Rainbow Kingdom',
        'about.pageSubtitle': 'Educational entertainment that promotes equality, friendship, and problem-solving through engaging adventures that children love and parents trust.',
        'about.equality.title': 'Kindness & Friendship',
        'about.equality.description': 'Teaching children to be kind to others and that friendship conquers all challenges.',
        'about.education.title': 'Educational Content',
        'about.education.description': 'Fun adventures that teach problem-solving, resilience, and important life lessons.',
        'about.quality.title': 'Quality Animation',
        'about.quality.description': 'Professional animation and storytelling that parents trust and kids love.',
        'about.mission.title': 'Our Mission',
        'about.mission.subtitle': 'Rainbow Kingdom is more than just entertainment – it\'s a platform for teaching children important life values through engaging storytelling and lovable characters.',
        'about.mission.paragraph1': 'Our mission is to create content that not only entertains but also educates, fostering a generation of kind, empathetic, and confident children.',
        'about.mission.paragraph2': 'Set in a magical world where everyone is equal and friendship conquers all challenges, Rainbow Kingdom provides a safe space for children to learn about diversity, problem-solving, and the importance of believing in yourself and others.',
        'about.mission.paragraph3': 'Every episode is carefully crafted to deliver meaningful messages while keeping children engaged with colorful animation, memorable characters, and exciting adventures that spark imagination and curiosity.',

        // Newsletter
        'newsletter.title': 'Never Miss an Episode',
        'newsletter.subtitle': 'Sign up for our newsletter and be the first to know when Rainbow Kingdom launches on your favorite platform!',
        'newsletter.placeholder': 'Enter your email address',
        'newsletter.button': 'Stay Updated',
        'newsletter.noSpam': 'No spam, just magical updates!',

        // Trailer
        'trailer.watchNow': 'Watch Trailer',
        'trailer.subtitle': 'Get a sneak peek into the magical world of Rainbow Kingdom!',
        'trailer.comingSoon': 'Coming Soon',

        // Footer
        'footer.description': 'A magical world where everyone is equal, and fun is always around the corner! Educational entertainment that children love and parents trust.',
        'footer.aboutUs': 'About Us',
        'footer.forParents': 'For Parents',
        'footer.characters': 'Characters',
        'footer.brandTitle': 'Rainbow Kingdom',
        'footer.privacy': 'Privacy Policy',
        'footer.terms': 'Terms of Service',
        'footer.contact': 'Contact',
        'footer.copyright': '© 2025 Pot Of Gold Production. All rights reserved.',

        // Parents Page
        'parents.title': 'For Parents',
        'parents.subtitle': 'Educational entertainment you can trust - discover why Rainbow Kingdom is perfect for your children\'s development and entertainment.',
        'parents.learningTitle': 'What Your Child Will Learn',
        'parents.learningSubtitle': 'Rainbow Kingdom provides valuable educational content through engaging storytelling that children love and parents trust.',
        'parents.socialSkills': 'Social Skills:',
        'parents.socialSkillsDesc': 'Characters demonstrate how to make friends, share, take turns, and work together to solve problems. These social interactions provide excellent models for your child\'s own relationships.',
        'parents.problemSolving': 'Problem-Solving:',
        'parents.problemSolvingDesc': 'Every episode presents challenges that characters overcome through creative thinking, persistence, and teamwork. Children learn that problems have solutions when approached with the right mindset.',
        'parents.emotionalIntelligence': 'Emotional Intelligence:',
        'parents.emotionalIntelligenceDesc': 'Characters express and manage emotions in healthy ways, teaching children to identify their own feelings and develop coping strategies for different situations.',
        'parents.diversity': 'Diversity & Inclusion:',
        'parents.diversityDesc': 'Rainbow Kingdom celebrates differences and shows that everyone has unique strengths to contribute, fostering acceptance and appreciation for diversity.',

        // Social Media
        'social.tiktok': 'TikTok',
        'social.instagram': 'Instagram',
        'social.youtube': 'YouTube',
        'social.facebook': 'Facebook',
        'social.instagram.link': 'https://www.instagram.com/rainbowkingdom.pl', // English Instagram

        // Language Toggle
        'lang.switchToPolish': 'Switch to Polish',
        'lang.switchToEnglish': 'Switch to English',

        // Common
        'common.stayUpdated': 'Stay Updated',
        'common.meetOurTeam': 'Meet Our Team',
        'common.meetOurTeamSubtitle': 'Meet the talented creators who bring the magical world of the Rainbow Kingdom to life!',
        'common.learnMoreAbout': 'Learn More About'
    },
    pl: {
        // Navigation
        'nav.home': 'Strona Główna',
        'nav.characters': 'Postacie',
        'nav.about': 'O Nas',
        'nav.parents': 'Dla Rodziców',

        // Hero Section
        'hero.title': 'Witaj w Tęczowym Królestwie',
        'hero.welcome': 'WITAJ',
        'hero.to': 'W',
        'hero.the': '',
        'hero.kingdom': 'KRÓLESTWIE',
        'hero.title.mobile.line1': 'WITAJ W',
        'hero.title.mobile.line2': 'TĘCZOWYM',
        'hero.title.mobile.line3': 'KRÓLESTWIE',
        'hero.title.desktop.line1': 'WITAJ W TĘCZOWYM ',
        'hero.title.desktop.line2': 'KRÓLESTWIE',
        'hero.subtitle': 'Magiczny świat, gdzie wszyscy są przyjaciółmi, a przygoda czeka tuż za rogiem!',
        'hero.description': 'Dołącz do Rainbow, Lily Lis, Wróżki Lawendy, Robina i Kreta Andrew w ekscytujących przygodach, które uczą przyjaźni, rozwiązywania problemów i znaczenia równości.',
        'hero.watchTrailer': 'Zobacz Zwiastun',
        'hero.meetCharacters': 'Poznaj Postacie',

        // Characters Section
        'characters.title': 'Poznaj Nasze Niesamowite Postacie',
        'characters.subtitle': 'Odkryj kompletne historie, osobowości i magiczne właściwości każdej ukochanej postaci z Tęczowego Królestwa!',
        'characters.learnMore': 'Dowiedz się więcej o',
        'characters.keyTraits': 'Kluczowe Cechy',
        'characters.meetAllFriends': 'Poznaj Wszystkich Naszych Przyjaciół',
        'characters.shareTheLove': 'Podziel się Miłością',

        // Character Data
        'character.rainbow.name': 'Tęcza',
        'character.rainbow.nickname': 'Tęcza',
        'character.rainbow.description': 'Tęcza to wesoły i mądry książę Tęczowego Królestwa, miejsca gdzie wszyscy są równi. Ze swoim charakterystycznym tęczowym tyłkiem, Tęcza jest pewny siebie, przyjazny i zawsze gotowy na nową przygodę. Chociaż jest mądry, bywa też trochę głupawy, co czyni go idealnym liderem i przyjacielem w tym kolorowym krainie.',
        'character.rainbow.quote': 'W Tęczowym Królestwie wszyscy są równi i wyjątkowi!',

        'character.lily.name': 'Lisica Lilly',
        'character.lily.nickname': 'Lilly',
        'character.lily.description': 'Lilly to sprytny i bystry lis w grupie. Jej superbohaterskie motto? "Żadna katastrofa, myślę szybciej, jestem mistrzem!" To ona zawsze wie, co robić w trudnej sytuacji. Choć potrafi być nieco psotna, wszystko to w dobrej zabawie, i zawsze służy pomocną łapą, gdy przyjaciele jej potrzebują.',
        'character.lily.quote': 'Żadna katastrofa, myślę szybciej, jestem mistrzem!',

        'character.lavender.name': 'Lawendowa Wróżka',
        'character.lavender.nickname': 'Lawendowa',
        'character.lavender.description': 'Wróżka Lawenda to magiczna pomocniczka, która pojawia się czasami, aby dodać odrobinę magii do każdego odcinka. Jej dobre serce i cudowne moce czynią ją wróżką do zadań specjalnych przy rozwiązywaniu problemów za pomocą odrobiny czarów.',
        'character.lavender.quote': 'Szczypta magii sprawia, że wszystko staje się lepsze!',

        'character.robin.name': 'Gryzi Piórek',
        'character.robin.nickname': 'Gryzi',
        'character.robin.description': 'Gryzi Piórek to mały ptak z sercem wielkim jak samo Tęczowe Królestwo! Pełen kolorów, Gryzi może być mały, ale wyróżnia się na swój własny, wyjątkowy sposób. Czy to latając wysoko, czy słodko śpiewając, Gryzi przynosi radość i kolorowy akcent wszędzie, gdzie się pojawi.',
        'character.robin.quote': 'Mały, ale potężny, z kolorowym sercem!',

        'character.andrew.name': 'Andrzej Kret',
        'character.andrew.nickname': 'Andrzej',
        'character.andrew.description': 'Andrzej Kret to ukochana, niezgrabna postacja, która zawsze ma dobre intencje, ale jakoś kończy powodując mały chaos. Jego dobre intencje często prowadzą do zabawnych wpadek, ale jego wielkie serce i postawa "nigdy się nie poddawaj" czynią go ulubieniem dzieci. Przygody Andrzej przypominają nam, że nie ma nic złego w popełnianiu błędów, o ile nie przestajemy próbować!',
        'character.andrew.quote': 'Ups! Ale nigdy się nie poddaję!',

        // Popup specific translations
        'popup.traits': 'Cechy Postaci',

        // Character Traits
        'trait.wise': 'Mądry',
        'trait.cheerful': 'Wesoły',
        'trait.leader': 'Przywódca',
        'trait.confident': 'Pewny Siebie',
        'trait.clever': 'Sprytny',
        'trait.witty': 'Dowcipny',
        'trait.helpful': 'Pomocny',
        'trait.smart': 'Inteligentny',
        'trait.magical': 'Magiczny',
        'trait.kind': 'Miły',
        'trait.enchanting': 'Czarujący',
        'trait.brave': 'Odważny',
        'trait.loyal': 'Lojalny',
        'trait.energetic': 'Energiczny',
        'trait.musical': 'Muzyczny',
        'trait.persistent': 'Wytrwały',
        'trait.funny': 'Zabawny',
        'trait.determined': 'Zdeterminowany',
        'trait.lovable': 'Kochany',

        // About Section
        'about.title': 'Edukacyjna Rozrywka<br>&nbsp;&nbsp;Która ma Znaczenie',
        'about.subtitle': 'Tęczowe Królestwo promuje równość, przyjaźń i rozwiązywanie problemów poprzez angażujące przygody, które dzieci kochają, a rodzice którym ufają.',
        'about.pageTitle': 'O Tęczowym Królestwie',
        'about.pageSubtitle': 'Edukacyjna rozrywka, która promuje równość, przyjaźń i rozwiązywanie problemów poprzez angażujące przygody, które dzieci kochają, a rodzice ufają.',
        'about.equality.title': 'Życzliwość i Przyjaźń',
        'about.equality.description': 'Uczenie dzieci życzliwości wobec innych i że przyjaźń pokonuje wszelkie wyzwania.',
        'about.education.title': 'Treści Edukacyjne',
        'about.education.description': 'Zabawne przygody, które uczą rozwiązywania problemów, odporności i ważnych życiowych lekcji.',
        'about.quality.title': 'Wysokiej Jakości Animacja',
        'about.quality.description': 'Profesjonalna animacja i opowiadanie historii, którym rodzice ufają, a dzieci kochają.',
        'about.mission.title': 'Nasza Misja',
        'about.mission.subtitle': 'Tęczowe Królestwo to więcej niż tylko rozrywka – to platforma do nauczania dzieci ważnych życiowych wartości poprzez angażujące opowiadanie historii i urocze postacie.',
        'about.mission.paragraph1': 'Naszą misją jest tworzenie treści, które nie tylko bawią, ale także edukują, wspierając pokolenie życzliwych, empatycznych i pewnych siebie dzieci.',
        'about.mission.paragraph2': 'Osadzony w magicznym świecie, gdzie wszyscy są równi, a przyjaźń pokonuje wszelkie wyzwania, Tęczowe Królestwo zapewnia bezpieczną przestrzeń dla dzieci do nauki o różnorodności, rozwiązywaniu problemów i znaczeniu wiary w siebie i innych.',
        'about.mission.paragraph3': 'Każdy odcinek jest starannie opracowany, aby przekazywać znaczące przesłania, jednocześnie utrzymując zaangażowanie dzieci kolorową animacją, niezapomnianymi postaciami i ekscytującymi przygodami, które rozpalają wyobraźnię i ciekawość.',

        // Newsletter
        'newsletter.title': 'Nie Przegap Żadnego Odcinka',
        'newsletter.subtitle': 'Zapisz się do naszego newslettera i bądź pierwszym, który dowie się, kiedy Tęczowe Królestwo zostanie uruchomione na Twojej ulubionej platformie!',
        'newsletter.placeholder': 'Wprowadź swój adres email',
        'newsletter.button': 'Bądź na Bieżąco',
        'newsletter.noSpam': 'Bez spamu, tylko magiczne aktualizacje!',

        // Trailer
        'trailer.watchNow': 'Zobacz Zwiastun',
        'trailer.subtitle': 'Rzuć okiem na magiczny świat Tęczowego Królestwa!',
        'trailer.comingSoon': 'Wkrótce',

        // Footer
        'footer.description': 'Magiczny świat, gdzie wszyscy są równi, a zabawa zawsze jest tuż za rogiem! Edukacyjna rozrywka, którą dzieci kochają, a rodzice którym ufają.',
        'footer.aboutUs': 'O Nas',
        'footer.forParents': 'Dla Rodziców',
        'footer.characters': 'Postacie',
        'footer.brandTitle': 'Tęczowe Królestwo',
        'footer.privacy': 'Polityka Prywatności',
        'footer.terms': 'Warunki Świadczenia Usług',
        'footer.contact': 'Kontakt',
        'footer.copyright': '© 2025 Pot Of Gold Production. Wszelkie prawa zastrzeżone.',

        // Parents Page
        'parents.title': 'Dla Rodziców',
        'parents.subtitle': 'Edukacyjna rozrywka, której możesz zaufać - odkryj, dlaczego Tęczowe Królestwo jest idealne dla rozwoju i rozrywki Twojego dziecka.',
        'parents.learningTitle': 'Czego Nauczy Się Twoje Dziecko',
        'parents.learningSubtitle': 'Tęczowe Królestwo dostarcza wartościowe treści edukacyjne poprzez angażujące opowiadanie historii, które dzieci kochają, a rodzice ufają.',
        'parents.socialSkills': 'Umiejętności Społeczne:',
        'parents.socialSkillsDesc': 'Postacie pokazują, jak nawiązywać przyjaźnie, dzielić się, czekać na swoją kolej i współpracować w rozwiązywaniu problemów. Te interakcje społeczne stanowią doskonałe wzorce dla własnych relacji Twojego dziecka.',
        'parents.problemSolving': 'Rozwiązywanie Problemów:',
        'parents.problemSolvingDesc': 'Każdy odcinek przedstawia wyzwania, które postacie pokonują poprzez kreatywne myślenie, wytrwałość i pracę zespołową. Dzieci uczą się, że problemy mają rozwiązania, gdy podchodzi się do nich z właściwym nastawieniem.',
        'parents.emotionalIntelligence': 'Inteligencja Emocjonalna:',
        'parents.emotionalIntelligenceDesc': 'Postacie wyrażają i zarządzają emocjami w zdrowy sposób, ucząc dzieci identyfikowania własnych uczuć i rozwijania strategii radzenia sobie w różnych sytuacjach.',
        'parents.diversity': 'Różnorodność i Włączenie:',
        'parents.diversityDesc': 'Tęczowe Królestwo celebruje różnice i pokazuje, że każdy ma unikalne mocne strony do wniesienia, wspierając akceptację i docenianie różnorodności.',

        // Social Media
        'social.tiktok': 'TikTok',
        'social.instagram': 'Instagram',
        'social.youtube': 'YouTube',
        'social.facebook': 'Facebook',
        'social.instagram.link': 'https://www.instagram.com/teczowekrolestwo.pl?igsh=MWRiaHF5aG54N3JlYw%3D%3D&utm_source=qr', // Polish Instagram

        // Language Toggle
        'lang.switchToPolish': 'Przełącz na Polski',
        'lang.switchToEnglish': 'Przełącz na Angielski',

        // Common
        'common.stayUpdated': 'Bądź na Bieżąco',
        'common.meetOurTeam': 'Poznaj Nasz Zespół',
        'common.meetOurTeamSubtitle': 'Poznaj utalentowanych twórców, którzy ożywiają magiczny świat Tęczowego Królestwa!',
        'common.learnMoreAbout': 'Dowiedz się więcej o'
    }
};

// Current language state
let currentLanguage = 'en';

// Initialize the page
document.addEventListener('DOMContentLoaded', function () {
    // Load saved language and ensure consistency
    initializeLanguage();

    // Update UI to reflect current language
    updateLanguageDisplay();
    updateAllTranslations();
    syncLinksWithLanguage();

    // Add animation classes for elements
    addScrollAnimations();

    // Initialize newsletter form
    initializeNewsletterForm();

    // Add smooth scrolling for navigation links
    initializeSmoothScrolling();

    // Add hover effects to interactive elements
    initializeHoverEffects();
});

// Apply data-lang attribute to the root for CSS language-specific rules
function applyLanguageDataAttribute() {
    try {
        document.documentElement.setAttribute('data-lang', currentLanguage);
        document.documentElement.setAttribute('lang', currentLanguage);
        document.body && document.body.setAttribute('data-lang', currentLanguage);
    } catch (e) {
        console.warn('Unable to set data-lang attribute', e);
    }
}

// Initialize language system with consistency checks
function initializeLanguage() {
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    const savedLanguage = localStorage.getItem('rainbow-kingdom-language');
    
    // Priority: URL param > saved value > default EN
    if (urlLang === 'en' || urlLang === 'pl') {
        currentLanguage = urlLang;
        localStorage.setItem('rainbow-kingdom-language', currentLanguage);
    } else if (savedLanguage === 'en' || savedLanguage === 'pl') {
        currentLanguage = savedLanguage;
    } else {
        currentLanguage = 'en';
        localStorage.setItem('rainbow-kingdom-language', currentLanguage);
    }
    
    // Force update to ensure consistency
    console.log('Language initialized:', currentLanguage);
    // Ensure CSS language selectors apply on first load
    applyLanguageDataAttribute();
}

// Language toggle functionality
function toggleLanguage() {
    // Toggle language
    currentLanguage = currentLanguage === 'en' ? 'pl' : 'en';
    
    // Save to localStorage immediately
    localStorage.setItem('rainbow-kingdom-language', currentLanguage);
    
    // Update UI immediately
    applyLanguageDataAttribute();
    updateLanguageDisplay();
    updateAllTranslations();
    syncLinksWithLanguage();
    
    // Log for debugging
    console.log('Language toggled to:', currentLanguage);
    
    // Force a small delay to ensure localStorage is written
    setTimeout(() => {
        const verified = localStorage.getItem('rainbow-kingdom-language');
        console.log('Language verified in storage:', verified);
    }, 100);
}

// Update language display in toggles
function updateLanguageDisplay() {
    const langText = document.getElementById('lang-text');
    const mobileLangText = document.getElementById('mobile-lang-text');
    const mobileFlag = document.getElementById('mobile-flag');
    const flagEn = document.getElementById('flag-en');
    const flagPl = document.getElementById('flag-pl');

    // Ensure root has data-lang for CSS rules like [data-lang="pl"] .rainbow-text
    applyLanguageDataAttribute();

    if (langText) {
        langText.textContent = currentLanguage === 'en' ? 'PL' : 'EN';
    }

    if (mobileLangText) {
        mobileLangText.textContent = currentLanguage === 'en' ? getText('lang.switchToPolish') : getText('lang.switchToEnglish');
    }

    if (mobileFlag) {
        mobileFlag.textContent = currentLanguage === 'en' ? '🇵🇱' : '🇺🇸';
    }

    // Update flag opacity
    if (flagEn && flagPl) {
        flagEn.style.opacity = currentLanguage === 'en' ? '1' : '0.4';
        flagPl.style.opacity = currentLanguage === 'pl' ? '1' : '0.4';
    }
}

// Update all translations on the page
function updateAllTranslations() {
    const elementsWithDataText = document.querySelectorAll('[data-text]');
    const elementsWithDataPlaceholder = document.querySelectorAll('[data-placeholder]');

    console.log('Updating translations for language:', currentLanguage);
    console.log('Found elements with data-text:', elementsWithDataText.length);

    elementsWithDataText.forEach(element => {
        const key = element.getAttribute('data-text');
        const translation = translations[currentLanguage][key];
        if (translation) {
            if (key === 'about.title') {
                element.innerHTML = translation; // Use innerHTML for about.title to handle HTML tags
            } else {
                element.textContent = translation;
            }
            // Debug specific parents page elements
            if (key.startsWith('parents.')) {
                console.log(`Translated ${key}: ${translation}`);
            }
        } else {
            console.warn(`Missing translation for key: ${key} in language: ${currentLanguage}`);
            // Also log what translations are available for parents
            if (key.startsWith('parents.')) {
                console.log('Available parents translations:', Object.keys(translations[currentLanguage]).filter(k => k.startsWith('parents.')));
            }
        }
    });

    elementsWithDataPlaceholder.forEach(element => {
        const key = element.getAttribute('data-placeholder');
        const translation = translations[currentLanguage][key];
        if (translation) {
            element.placeholder = translation;
        }
    });

    // Update social media links based on language
    updateSocialMediaLinks();

    // Special handling for rainbow text colors in Polish/English
    updateRainbowText();
    // Ensure hero title line layout per language
    updateHeroTitleLayout();
    
    // Update popup content if popup is currently open
    const popup = document.getElementById('characterPopup');
    if (popup && popup.classList.contains('active')) {
        const name = document.getElementById('popupCharacterName');
        const quote = document.getElementById('popupCharacterQuote');
        const description = document.getElementById('popupCharacterDescription');
        
        if (name && name.getAttribute('data-text')) {
            const nameKey = name.getAttribute('data-text');
            const nameTranslation = translations[currentLanguage][nameKey];
            if (nameTranslation) name.textContent = nameTranslation;
        }
        
        if (quote && quote.getAttribute('data-text')) {
            const quoteKey = quote.getAttribute('data-text');
            const quoteTranslation = translations[currentLanguage][quoteKey];
            if (quoteTranslation) quote.textContent = quoteTranslation;
        }
        
        if (description && description.getAttribute('data-text')) {
            const descKey = description.getAttribute('data-text');
            const descTranslation = translations[currentLanguage][descKey];
            if (descTranslation) description.textContent = descTranslation;
        }
    }
}

// Update social media links based on current language
function updateSocialMediaLinks() {
    // Define social media links for each language
    const socialLinks = {
        en: {
            instagram: 'https://www.instagram.com/rainbowkingdom.eu?igsh=cDJ1NjFpNjBsMGxy&utm_source=qr',
            facebook: 'https://www.facebook.com/profile.php?id=61564509247140&sk=friends_likes',
            youtube: 'https://www.youtube.com/@RainbowKingdom86',
            tiktok: '#' // TikTok link is the same for both languages
        },
        pl: {
            instagram: 'https://www.instagram.com/teczowekrolestwo.pl?igsh=MWRiaHF5aG54N3JlYw%3D%3D&utm_source=qr',
            facebook: 'https://www.facebook.com/profile.php?id=61564509247140&sk=friends_likes',
            youtube: 'https://www.youtube.com/@RainbowKingdom86',
            tiktok: '#' // TikTok link is the same for both languages
        }
    };

    const currentLinks = socialLinks[currentLanguage];

    // Update social links in hero section
    const heroInstagramLinks = document.querySelectorAll('.social-btn.instagram');
    heroInstagramLinks.forEach(link => {
        link.href = currentLinks.instagram;
    });

    const heroFacebookLinks = document.querySelectorAll('.social-btn.facebook');
    heroFacebookLinks.forEach(link => {
        link.href = currentLinks.facebook;
    });

    const heroYoutubeLinks = document.querySelectorAll('.social-btn.youtube');
    heroYoutubeLinks.forEach(link => {
        link.href = currentLinks.youtube;
    });

    const heroTiktokLinks = document.querySelectorAll('.social-btn.tiktok');
    heroTiktokLinks.forEach(link => {
        link.href = currentLinks.tiktok;
    });

    // Update social links in footer
    const footerInstagramLinks = document.querySelectorAll('.footer-social-link[aria-label="Instagram"]');
    footerInstagramLinks.forEach(link => {
        link.href = currentLinks.instagram;
    });

    const footerFacebookLinks = document.querySelectorAll('.footer-social-link[aria-label="Facebook"]');
    footerFacebookLinks.forEach(link => {
        link.href = currentLinks.facebook;
    });

    const footerYoutubeLinks = document.querySelectorAll('.footer-social-link[aria-label="YouTube"]');
    footerYoutubeLinks.forEach(link => {
        link.href = currentLinks.youtube;
    });

    const footerTiktokLinks = document.querySelectorAll('.footer-social-link[aria-label="TikTok"]');
    footerTiktokLinks.forEach(link => {
        link.href = currentLinks.tiktok;
    });
}

// Update rainbow text with proper colors for Polish/English
function updateRainbowText() {
    const rainbowTexts = document.querySelectorAll('.rainbow-text, .rainbow-line');

    rainbowTexts.forEach(rainbowText => {
        if (currentLanguage === 'pl') {
            // Polish: TĘCZOWYM
            rainbowText.innerHTML = `
                <span class="letter" style="color: #d03926">T</span>
                <span class="letter" style="color: #e2993b">Ę</span>
                <span class="letter" style="color: #eab308">C</span>
                <span class="letter" style="color: #e5ed51">Z</span>
                <span class="letter" style="color: #75e901">O</span>
                <span class="letter" style="color: #415bd4">W</span>
                <span class="letter" style="color: #2b3898">Y</span>
                <span class="letter" style="color: #263578">M</span>
            `;
        } else {
            // English: RAINBOW
            rainbowText.innerHTML = `
                <span class="letter" style="color: #d03926">R</span>
                <span class="letter" style="color: #e2993b">A</span>
                <span class="letter" style="color: #eab308">I</span>
                <span class="letter" style="color: #e5ed51">N</span>
                <span class="letter" style="color: #75e901">B</span>
                <span class="letter" style="color: #415bd4">O</span>
                <span class="letter" style="color: #263578">W</span>
            `;
        }

        // Add kingdom word for desktop version
        if (rainbowText.classList.contains('rainbow-line')) {
            const kingdomWord = currentLanguage === 'pl' ? ' KRÓLESTWIE' : ' KINGDOM';
            rainbowText.innerHTML += `<span class="kingdom-word">${kingdomWord}</span>`;
        }
    });
}

// Keep Polish hero first line as single line "WITAJ W"
function updateHeroTitleLayout() {
    const welcomeEl = document.querySelector('.hero-title .welcome-text');
    const groupEl = document.querySelector('.hero-title .to-the-line');
    if (!welcomeEl || !groupEl) return;

    if (currentLanguage === 'pl') {
        // Merge "WITAJ" and "W" into the first span and hide the group to keep one line
        const welcome = translations.pl['hero.welcome'] || 'WITAJ';
        const preposition = translations.pl['hero.to'] || 'W';
        welcomeEl.textContent = `${welcome} ${preposition}`;
        groupEl.style.display = 'none';
    } else {
        // Restore English layout
        welcomeEl.textContent = translations.en['hero.welcome'] || 'WELCOME';
        groupEl.style.display = '';
        // Also ensure the child texts are correct
        const toEl = groupEl.querySelector('.to-text');
        const theEl = groupEl.querySelector('.the-text');
        if (toEl) toEl.textContent = translations.en['hero.to'] || 'TO';
        if (theEl) theEl.textContent = translations.en['hero.the'] || 'THE';
    }
}

// Ensure all internal links carry the current language as a URL param
function syncLinksWithLanguage() {
    try {
        const anchors = document.querySelectorAll('a[href]');
        anchors.forEach(a => {
            const href = a.getAttribute('href');
            if (!href) return;
            // Only touch internal .html links (not external http(s) or hashes/mailto/tel)
            const isExternal = /^(https?:|mailto:|tel:)/i.test(href);
            const isHashOnly = href.startsWith('#');
            const isHtml = /\.html(\?|#|$)/i.test(href);
            if (isExternal || isHashOnly || !isHtml) return;

            const url = new URL(href, window.location.origin);
            url.searchParams.set('lang', currentLanguage);
            a.setAttribute('href', url.pathname + (url.search ? url.search : '') + (url.hash ? url.hash : ''));
        });
    } catch (e) {
        console.warn('syncLinksWithLanguage failed', e);
    }
}

// Mobile menu functionality
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuBtn = document.querySelector('.mobile-menu-btn');

    if (mobileMenu && menuBtn) {
        const isActive = mobileMenu.classList.contains('active');

        if (isActive) {
            mobileMenu.classList.remove('active');
            menuBtn.classList.remove('active');
            menuBtn.style.display = '';
        } else {
            mobileMenu.classList.add('active');
            menuBtn.classList.add('active');
            // Hide floating hamburger when panel open
            menuBtn.style.display = 'none';
        }
    }
}

function closeMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuBtn = document.querySelector('.mobile-menu-btn');

    if (mobileMenu && menuBtn) {
        mobileMenu.classList.remove('active');
        menuBtn.classList.remove('active');
        // Restore hamburger visibility on close
        menuBtn.style.display = '';
    }
}

// Scroll animations
function addScrollAnimations() {
    // Intersection Observer for scroll animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '-50px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-in');
            }
        });
    }, observerOptions);

    // Observe all cards and sections
    document.querySelectorAll('.character-card, .education-item, .section-title, .section-subtitle').forEach(el => {
        observer.observe(el);
    });
}

// Newsletter form handling
function initializeNewsletterForm() {
    const form = document.querySelector('.newsletter-form');
    if (form) {
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const email = form.querySelector('input[type="email"]').value;

            if (email) {
                // Simulate newsletter signup
                alert(currentLanguage === 'en'
                    ? 'Thank you for subscribing! You\'ll be the first to know about Rainbow Kingdom updates.'
                    : 'Dziękujemy za subskrypcję! Będziesz pierwszą osobą, która dowie się o aktualizacjach Tęczowego Królestwa.');
                form.reset();
            }
        });
    }
}

// Smooth scrolling for navigation
function initializeSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);

            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });

                // Close mobile menu if open
                closeMobileMenu();
            }
        });
    });
}

// Hover effects and interactions
function initializeHoverEffects() {
    // Add floating animation to character images
    document.querySelectorAll('.characters-image, .characters-image-desktop').forEach(img => {
        let animationFrame;

        function floatAnimation() {
            const time = Date.now() * 0.002;
            const offsetY = Math.sin(time) * 8;
            img.style.transform = `translateY(${offsetY}px)`;
            animationFrame = requestAnimationFrame(floatAnimation);
        }

        // Start animation on hover, stop when not hovering
        img.addEventListener('mouseenter', () => {
            floatAnimation();
        });

        img.addEventListener('mouseleave', () => {
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
            img.style.transform = 'translateY(0px)';
        });
    });

    // Add button click effects (exclude mobile menu toggles and popup close)
    document.querySelectorAll('button:not(.mobile-menu-btn):not(.mobile-menu-close):not(.character-popup-close), .btn-primary, .btn-secondary, .btn-red').forEach(btn => {
        btn.addEventListener('click', function (e) {
            // Create ripple effect
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.style.cssText = `
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                transform: scale(0);
                left: ${x}px;
                top: ${y}px;
                width: ${size}px;
                height: ${size}px;
                animation: ripple 0.6s linear;
                pointer-events: none;
            `;

            // Only set relative positioning if currently static to avoid breaking fixed/absolute buttons
            const computed = window.getComputedStyle(this).position;
            if (computed === 'static') {
                this.style.position = 'relative';
            }
            this.style.overflow = 'hidden';
            this.appendChild(ripple);

            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });
}

// Add ripple animation CSS
const style = document.createElement('style');
style.textContent = `
    @keyframes ripple {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }
    
    .animate-in {
        animation: fadeInUp 0.8s ease forwards;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Enhanced hover effects */
    .character-card:hover {
        transform: translateY(-5px);
        transition: all 0.3s ease;
    }
    
    .character-card:focus,
    .character-card:active {
        outline: none;
        border: none;
    }
    
    .education-item:hover {
        transform: translateY(-8px);
        transition: all 0.3s ease;
    }
    
    .social-btn:hover {
        transform: translateY(-2px) scale(1.05);
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover, .btn-secondary:hover, .btn-red:hover {
        transform: translateY(-2px) scale(1.05);
        transition: all 0.3s ease;
    }
`;
document.head.appendChild(style);

// Handle video play button (if present)
document.addEventListener('click', function (e) {
    if (e.target.closest('.play-btn')) {
        const video = document.querySelector('.video-thumb');
        if (video && video.tagName === 'VIDEO') {
            video.play();
            e.target.closest('.play-btn').style.display = 'none';
        }
    }
});

// Close mobile menu when clicking outside
document.addEventListener('click', function (e) {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuBtn = document.querySelector('.mobile-menu-btn');

    if (mobileMenu && menuBtn &&
        !mobileMenu.contains(e.target) &&
        !menuBtn.contains(e.target) &&
        mobileMenu.classList.contains('active')) {
        closeMobileMenu();
    }
});

// Keyboard navigation support
document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
        closeMobileMenu();
    }
});

// Handle form accessibility
document.querySelectorAll('input, button, select, textarea').forEach(element => {
    element.addEventListener('focus', function () {
        this.classList.add('focused');
    });

    element.addEventListener('blur', function () {
        this.classList.remove('focused');
    });
});

// Character Popup Functionality
function openCharacterPopup(characterId) {
    const popup = document.getElementById('characterPopup');
    const modal = popup.querySelector('.character-popup-modal');
    const image = document.getElementById('popupCharacterImage');
    const name = document.getElementById('popupCharacterName');
    const quote = document.getElementById('popupCharacterQuote');
    const description = document.getElementById('popupCharacterDescription');
    const traitsContainer = document.getElementById('popupCharacterTraits');
    
    // Character data mapping
    const characterData = {
        rainbow: {
            image: 'public/rainbowbutt.png',
            traits: ['trait.wise', 'trait.cheerful', 'trait.leader', 'trait.confident']
        },
        lily: {
            image: 'public/lillythefox.png',
            traits: ['trait.clever', 'trait.witty', 'trait.helpful', 'trait.smart']
        },
        lavender: {
            image: 'public/fairy.png',
            traits: ['trait.magical', 'trait.kind', 'trait.helpful', 'trait.enchanting']
        },
        robin: {
            image: 'public/robin.png',
            traits: ['trait.brave', 'trait.loyal', 'trait.energetic', 'trait.musical']
        },
        andrew: {
            image: 'public/andrew.png',
            traits: ['trait.persistent', 'trait.funny', 'trait.determined', 'trait.lovable']
        }
    };
    
    const character = characterData[characterId];
    if (!character) return;
    
    // Update popup content
    image.src = character.image;
    image.alt = getText(`character.${characterId}.name`);
    
    // Set text data attributes for translation
    name.setAttribute('data-text', `character.${characterId}.name`);
    quote.setAttribute('data-text', `character.${characterId}.quote`);
    description.setAttribute('data-text', `character.${characterId}.description`);
    
    // Update text content
    name.textContent = getText(`character.${characterId}.name`);
    quote.textContent = getText(`character.${characterId}.quote`);
    description.textContent = getText(`character.${characterId}.description`);
    
    // Populate traits
    traitsContainer.innerHTML = '';
    character.traits.forEach(traitKey => {
        const traitBadge = document.createElement('span');
        traitBadge.className = 'popup-trait-badge';
        traitBadge.textContent = getText(traitKey);
        traitsContainer.appendChild(traitBadge);
    });
    
    // Add character-specific class to modal
    modal.className = 'character-popup-modal';
    modal.classList.add(characterId);
    
    // Show popup with animation
    popup.style.display = 'flex';
    setTimeout(() => {
        popup.classList.add('active');
    }, 10);
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
    
    // Focus trap for accessibility
    popup.focus();
}

function closeCharacterPopup() {
    const popup = document.getElementById('characterPopup');
    const modal = popup.querySelector('.character-popup-modal');
    
    popup.classList.remove('active');
    
    // Remove any character-specific classes from modal
    if (modal) {
        modal.classList.remove('rainbow', 'lily', 'lavender', 'robin', 'andrew');
    }
    
    setTimeout(() => {
        popup.style.display = 'none';
        document.body.style.overflow = '';
    }, 300);
}

// Close popup with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const popup = document.getElementById('characterPopup');
        if (popup.classList.contains('active')) {
            closeCharacterPopup();
        }
    }
});

// Helper function to get translated text
function getText(key) {
    return translations[currentLanguage] && translations[currentLanguage][key] 
        ? translations[currentLanguage][key] 
        : key;
}

// Manual function to force refresh translations (for debugging)
function forceRefreshTranslations() {
    console.log('Force refreshing translations...');
    updateLanguageDisplay();
    updateAllTranslations();
    console.log('Translation refresh complete');
}

// Force language consistency check on page visibility change
document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
        // Page became visible, check language consistency
        const savedLanguage = localStorage.getItem('rainbow-kingdom-language');
        if (savedLanguage && savedLanguage !== currentLanguage) {
            currentLanguage = savedLanguage;
            applyLanguageDataAttribute();
            updateLanguageDisplay();
            updateAllTranslations();
            console.log('Language synchronized on page focus:', currentLanguage);
        }
    }
});

// Also check on window focus
window.addEventListener('focus', function() {
    const savedLanguage = localStorage.getItem('rainbow-kingdom-language');
    if (savedLanguage && savedLanguage !== currentLanguage) {
        currentLanguage = savedLanguage;
        applyLanguageDataAttribute();
        updateLanguageDisplay();
        updateAllTranslations();
        console.log('Language synchronized on window focus:', currentLanguage);
    }
});